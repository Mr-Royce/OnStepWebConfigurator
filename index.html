<!-- index.html (root folder) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnStepX Configurator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .tab-content { border: 1px solid #dee2e6; border-top: none; padding: 15px; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">OnStepX Configurator</h1>
        <form id="configForm">
            <ul class="nav nav-tabs" id="configTabs" role="tablist">
                <li class="nav-item"><a class="nav-link active" id="controller-tab" data-bs-toggle="tab" href="#controller">Controller</a></li>
                <li class="nav-item"><a class="nav-link" id="mount-tab" data-bs-toggle="tab" href="#mount">Mount</a></li>
                <!-- Other tabs -->
            </ul>

            <div class="tab-content mt-3">
                <div class="tab-pane fade show active" id="controller">
                    <div class="mb-3">
                        <label for="PINMAP" class="form-label">Pinmap:</label>
                        <select name="PINMAP" class="form-select">
                            <option value="OFF">OFF</option>
                            <option value="BTT_SKR_PRO" selected>BTT_SKR_PRO</option>
                            <!-- Add all options -->
                        </select>
                    </div>
                    <!-- Add other fields statically -->
                </div>
                <!-- Other tab contents -->
            </div>

            <div class="mt-3">
                <div class="input-group mb-3">
                    <input type="text" id="github_url" class="form-control" placeholder="Enter GitHub Config.h URL">
                    <button type="button" onclick="fetchFromGitHub()" class="btn btn-info">Fetch from GitHub</button>
                </div>
                <button type="button" onclick="savePreset()" class="btn btn-primary">Save Preset</button>
                <input type="file" id="loadPreset" class="d-none" onchange="loadPreset(this)">
                <button type="button" onclick="document.getElementById('loadPreset').click()" class="btn btn-secondary">Load Preset</button>
                <button type="button" onclick="generateConfig()" class="btn btn-success">Generate Config</button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function fetchFromGitHub() {
            const url = document.getElementById('github_url').value;
            if (url) {
                const rawUrl = url.replace('github.com', 'raw.githubusercontent.com').replace('/blob/', '/');
                fetch(rawUrl)
                    .then(response => response.text())
                    .then(data => {
                        const lines = data.split('\n');
                        lines.forEach(line => {
                            const match = line.match(/#define\s+(\w+)\s+(.+?)(?:\s+\/\/|$)/);
                            if (match) {
                                const [_, key, value] = match;
                                const input = document.querySelector(`[name="${key}"]`);
                                if (input) input.value = value.replace(/"/g, '');
                            }
                        });
                    })
                    .catch(err => alert('Failed to fetch: ' + err));
            }
        }

        function savePreset() {
            const formData = new FormData(document.getElementById('configForm'));
            const config = Object.fromEntries(formData);
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'preset.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function loadPreset(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const config = JSON.parse(e.target.result);
                    for (const [key, value] of Object.entries(config)) {
                        const input = document.querySelector(`[name="${key}"]`);
                        if (input) input.value = value;
                    }
                };
                reader.readAsText(file);
            }
        }

        function generateConfig() {
            const formData = new FormData(document.getElementById('configForm'));
            const config = Object.fromEntries(formData);
            let configLines = [
                "/* Configuration for OnStepX */",
                "",
                "// CONTROLLER",
                `#define PINMAP                        ${config.PINMAP}`,
                // Add all #define lines here (static version of config_generator.py)
            ];
            const blob = new Blob([configLines.join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Config.h';
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
